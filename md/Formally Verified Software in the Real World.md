# Formally Verified Software in the Real World

IN FEBRUARY 2017, a helicopter took off from a Boeing facility in Mesa, AZ, on a routine mission around nearby hills. It flew its course fully autonomously, and the safety pilot, required by the Federal Aviation Administration, did not touch any controls during the flight. This was not the first autonomous flight of the AH-6, dubbed the Unmanned Little Bird (ULB);3 it had been doing them for years. This time, however, the aircraft was subjected to mid-flight cyber attacks. The central mission computer was attacked by rogue camera software, as well as by a virus delivered through a compromised USB stick that had been inserted during maintenance. The attack compromised some subsystems but could not affect the safe operation of the aircraft.

2017年2月，一架直升机从位于亚利桑那州梅萨的波音工厂起飞，执行环绕附近山丘的例行任务。飞机完全自主飞行，按照美国联邦航空管理局(Federal Aviation Administration)的要求，安全驾驶员在飞行过程中没有接触任何控制装置。这不是AH-6的第一次自主飞行，被称为“无人小鸟”(ULB);多年来它一直在这么做。然而，这一次，这架飞机在飞行途中遭遇了网络攻击。中央任务计算机遭到了流氓摄像头软件的攻击，以及通过一个在维护期间插入的受损u盘传播的病毒。这次攻击破坏了一些子系统，但没有影响飞机的安全运行。

One might think surviving such an attack is not a big deal, certainly that military aircraft would be robust against cyber attacks. In reality, a “red team” of professional penetration testers hired by the Defense Advanced Research Projects Agency (DARPA) under its High-Assurance Cyber Military Systems (HACMS) program had in 2013 compromised the baseline version of the ULB, designed for safety rather than security, to the point where it could have crashed it or diverted to any location of its choice. In this light, risking an in-flight attack with a human on board indicates that something had changed dramatically.

有人可能会认为，在这样的攻击中幸存下来并不是什么大事，但可以肯定的是，军用飞机在面对网络攻击时将表现得十分强大。在现实中,一个“红色团队”的专业渗透测试人员受雇于美国国防高级研究计划局(DARPA)在其高可靠性网络军事系统(HACMS)计划2013年的基线版本ULB妥协,为安全而不是设计,它会崩溃或转移到任何位置的选择。在这种情况下，冒着飞机上有人攻击的危险表明情况发生了巨大的变化。

This article explains that change and the technology that enabled it. Specifically, it is about technology developed under the HACMS program, aiming to ensure the safe operation of critical real-world systems in a hostile cyber environment—multiple autonomous vehicles in this case. The technology is based on formally verified software, or software with machinechecked mathematical proofs it behaves according to its specification. While this article is not about the formal methods themselves, it explains how the verified artifacts can be used to secure practical systems. The most impressive outcome of HACMS is arguably that the technology could be retrofitted onto existing real-world systems, dramatically improving their cyber resilience, a process called “seismic security retrofit” in analogy to, say, the seismic retrofit of buildings. Moreover, most of the re-engineering was done by Boeing engineers, not by formal verification researchers.

这篇文章解释了改变和使它成为可能的技术。具体来说，它是关于在HACMS项目下开发的技术，旨在确保在一个敌对的网络环境中，关键的真实世界系统的安全运行。该技术基于经过正式验证的软件，或根据其规范运行的带有经过机器验证的数学证明的软件。虽然本文不讨论正式方法本身，但它解释了如何使用经过验证的构件来保护实际的系统。HACMS最令人印象深刻的成果是，该技术可以被改造到现有的真实世界系统上，极大地提高它们的网络弹性，这一过程被称为“地震安全改造”，类似于建筑物的地震改造。此外，大部分的重新设计是由波音的工程师完成的，而不是由正式的验证研究人员。

By far, not all the software on the HACMS vehicles was built on the basis of mathematical models and reasoning; the field of formal verification is not yet ready for such scale. However, HACMS demonstrated that significant improvement is feasible by applying formal techniques strategically to the most critical parts of the overall system. The HACMS approach works for systems in which the desired security property can be achieved through purely architecture-level enforcement. Its foundation is our verified microkernel, seL4, discussed later, which guarantees isolation between subsystems except for well-defined communication channels that are subject to the system’s security policy. This isolation is leveraged by system-level component architectures that, through architecture, enforce the desired security property, and our verified component framework, CAmkES. The CAmkES framework integrates with architecture analysis tools from Rockwell Collins and the University of Minnesota, along with trusted high-assurance software components using domainspecific languages from Galois Inc.

到目前为止，并不是所有的HACMS车辆上的软件都是建立在数学模型和推理的基础上的;正式核查领域尚未为这种规模做好准备。然而，HACMS证明，通过将正式的技术战略性地应用于整个系统的最关键部分，显著的改进是可行的。HACMS方法适用于这样的系统:在这些系统中，可以通过纯粹的体系结构级强制实现所需的安全属性。它的基础是我们稍后讨论的经过验证的微内核seL4，它保证了子系统之间的隔离，除了受系统安全策略约束的良好定义的通信通道之外。系统级组件体系结构利用了这种隔离，通过体系结构实现所需的安全属性，以及经过验证的组件框架CAmkES。CAmkES框架集成了来自Rockwell Collins和明尼苏达大学的体系结构分析工具，以及使用Galois公司的领域特定语言的可信的高可靠性软件组件。

The HACMS achievements are based on the software engineer’s trusty old friend—modularization. What is new is that formal methods provide proof that interfaces are observed and module internals are encapsulated. This guaranteed enforcement of modularization allows engineers, like those at Boeing, who are not formal-method experts, to construct new or even retrofit existing systems, as discussed later, and achieve high resilience, even though the tools do not yet provide an overall proof of system security.

HACMS的成就是基于软件工程师信赖的老朋友——模块化。新出现的是正式方法提供了接口被观察到和模块内部被封装的证据。这种模块化的强制执行使得工程师们，比如波音公司的那些不是正式方法专家的工程师们，可以构建新的或者甚至改进现有的系统(如后面所讨论的)，并获得高弹性，即使这些工具还没有提供系统安全性的全面证明。

## Formal Verification

Mathematical correctness proofs of programs go back to at least the 1960s, but for a long time, their real-world benefit to software development was limited in scale and depth. However, a number of impressive breakthroughs have been seen in recent years in the formal code-level verification of reallife systems, from the verified C compiler CompCert to the verified seL4 microkernel, verified conference system CoCon, verified ML compiler CakeML, verified interactive theorem provers Milawa, and Candle, verified crash-resistant file system FSCQ, verified distributed system IronFleet, and verified concurrent kernel framework CertiKOS, as well as significant mathematical theorems, including the Four Colour Theorem, mechanized proof of the Kepler Conjecture, and Odd Order Theorem. None of these are toy systems. For instance, Comp- Cert is a commercial product, the seL4 microkernel is used in aerospace, autonomous aviation, and as an Internet of Things platform, and the CoCon system has been used in multiple fullscale scientific conferences.

- 28. Leroy, X. Formal verification of a realistic compiler. Commun. ACM 52, 7 (July 2009), 107–115.
- 22. Klein, G., Andronick, J., Elphinstone, K., Murray, T., Sewell, T., Kolanski, R., and Heiser, G. Comprehensive formal verification of an OS microkernel. ACM Transactions on Computer Systems 32, 1 (Feb. 2014), 2:1–2:70.
- 23. Klein, G., Elphinstone, K., Heiser, G., Andronick, J., Cock, D., Derrin, P., Elkaduwe, D., Engelhardt, K., Kolanski, R., Norrish, M., Sewell, T., Tuch, H., and Winwood, S. seL4: Formal verification of an OS kernel. In Proceedings of the 22nd ACM Symposium on Operating Systems Principles (Big Sky, MT, Oct. 11–14). ACM Press, New York, 2009, 207–220.

程序的数学正确性证明至少可以追溯到20世纪60年代，但是在很长一段时间内，它们对软件开发的实际好处在规模和深度上是有限的。然而,近年来许多令人印象深刻的突破已经在正式进行代码级验证的一个真实系统中,从C编译器验证CompCert seL4微核验证,验证CoCon会议系统,验证了ML编译器CakeML,验证交互式定理验证Milawa,蜡烛,文件系统崩溃FSCQ验证,验证分布式系统IronFleet,和验证并发CertiKOS内核框架,以及重要的数学定理，包括四色定理，开普勒猜想的机械化证明，和奇阶定理。这些都不是玩具系统。例如，Comp-Cert是一个商业产品，seL4微内核被用于航空航天、自主航空和物联网平台，而CoCon系统被用于多个大型科学会议。
